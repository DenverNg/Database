-- ghi chú 1 dòng 

-- tạo csdl => csdl đó phải chưa có trong hệ quản trị
-- kiểm tra coi csdl muốn tạo đã tồn tại chưa
USE master
GO
IF DB_ID('QLDOIBONG') IS NOT NULL
    --XÓA CSDL NÀY ĐI
    DROP DATABASE QLDOIBONG
GO
-- ĐỂ ĐẢM BẢO KHỐI LỆNH Ở TRÊN KẾT THÚC
--TẠO CSDL
CREATE DATABASE QLDOIBONG
GO
USE QLDOIBONG

--TẠO TẤT CẢ CÁC BẢNG & KHÓA CHÍNH CỦA NÓ 
CREATE TABLE DOI
(
    --KHAI BAO THUOC TINH TRONG BANG
    IDDOI INT,
    TENDOI NVARCHAR(50),
    DOITRUONG INT,
    SOLUONG INT,

    --TAO KHOA CHINH CHO BANG
    CONSTRAINT PK_DOI -- DAT TEN CHO KHOA CHINH
    PRIMARY KEY(IDDOI)
)

CREATE TABLE BOTRI
(
    IDDOI INT,
    IDTHANHVIEN INT,
    DIACHI NVARCHAR(50),
    NHIEMVU NVARCHAR(50),
    QUANLI INT,

    CONSTRAINT PK_BOTRI
    PRIMARY KEY (IDDOI, IDTHANHVIEN)
)

CREATE TABLE THANHVIEN
(
    IDTHANHVIEN INT,
    HOTEN NVARCHAR(50),
    SOCMND CHAR(9),
    DIACHI NVARCHAR(50),
    NGAYSINH DATE,

    CONSTRAINT PK_THANHVIEN
    PRIMARY KEY (IDTHANHVIEN)
)

--TAO MOI QUAN HE + FK
ALTER TABLE BOTRI 
ADD 
    CONSTRAINT FK_BOTRI_DOI --DAT TEN FK
    FOREIGN KEY (IDDOI) --KHAI BAO FK CO THUOC TINH GI
    REFERENCES DOI, --TAO DAY LIEN KET

    CONSTRAINT FK_BOTRI_THANHVIEN_ID
    FOREIGN KEY (IDTHANHVIEN)
    REFERENCES THANHVIEN,

    CONSTRAINT FK_BOTRI_THANHVIEN_QL
    FOREIGN KEY (QUANLI)
    REFERENCES THANHVIEN

ALTER TABLE DOI
ADD 
    CONSTRAINT FK_DOI_THANHVIEN
    FOREIGN KEY (DOITRUONG)
    REFERENCES THANHVIEN

--NHAP LIEU VAO BANG
INSERT DOI
    (IDDOI, TENDOI )
VALUES
    (2, N'Đội Tân Phú'),
    (7, N'Đội Bình Phú')

SET DATEFORMAT DMY
GO

INSERT THANHVIEN
    (IDTHANHVIEN, HOTEN, SOCMND, DIACHI, NGAYSINH)
VALUES
    (1, N'Nguyễn Quan Tùng', '240674018', N'TPHCM', '30/1/2000'),
    (2, N'Lưu Phi Nam', '240674027', N'Quảng Nam', '12/3/2001' ),
    (3, N'Lê Quang Bảo', '240674063', N'Quảng Ngãi', '14/5/1999' ),
    (4, N'Hà Ngọc Thúy', '240674504', N'TPHCM', '26/7/1998' ),
    (5, N'Trương Thị Minh', '240674405', N'Hà Nội', NULL ),
    (6, N'Ngô Thị Thủy', '240674306', NULL, '18/9/2000' )

INSERT BOTRI
    (IDDOI, IDTHANHVIEN, DIACHI, NHIEMVU, QUANLI)
VALUES
    (2, 2, N'123 Vườn Lài Tân Phú', N'Trực khu vực vòng xoay', '1'),
    (2, 1, N'45 Phú Thọ Hòa Tân Phú', N'Theo dõi hoạt động', '1'),
    (7, 3, N'11 Chợ lớn Bình Phú', NULL, '5'),
    (7, 4, N'2 Bis Nguyễn Văn Cừ Q5', NULL, '3'),
    (7, 5, N'1Bis Trần Đình Xu Q1', NULL, NULL)

UPDATE DOI
SET DOITRUONG = 1, SOLUONG =11
WHERE IDDOI=2

UPDATE DOI
SET DOITRUONG=5, SOLUONG = 15
WHERE IDDOI=7


SELECT *
FROM DOI
SELECT *
FROM THANHVIEN
SELECT *
FROM BOTRI